{% extends 'analyzer/base.html' %}

{% block title %}{{ image.name }} - Detalhes da Imagem{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-image"></i> {{ image.name }}
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'analysis_results' aia_file.pk %}" class="btn btn-outline-secondary me-2">
            <i class="bi bi-arrow-left"></i> Voltar aos Resultados
        </a>
        {% if image.asset_type == 'icon' %}
        <a href="{% url 'material_design_analysis' image.pk %}" class="btn btn-outline-primary me-2">
            <i class="bi bi-palette"></i> Análise Material Design
        </a>
        {% endif %}
        <a href="{{ image.extracted_file.url }}" target="_blank" class="btn btn-primary">
            <i class="bi bi-download"></i> Abrir Original
        </a>
    </div>
</div>

<div class="row">
    <!-- Image Preview -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-eye"></i> Preview
                </h5>
            </div>
            <div class="card-body text-center">
                <img src="{{ image.extracted_file.url }}" 
                     class="img-fluid" 
                     alt="{{ image.name }}"
                     style="max-height: 400px; border: 1px solid #dee2e6;">
            </div>
        </div>
    </div>
    
    <!-- Image Details -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-info-circle"></i> Propriedades Técnicas
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td><strong>Nome:</strong></td>
                        <td>{{ image.name }}</td>
                    </tr>
                    <tr>
                        <td><strong>Caminho Original:</strong></td>
                        <td><code>{{ image.original_path }}</code></td>
                    </tr>
                    <tr>
                        <td><strong>Dimensões:</strong></td>
                        <td>{{ image.width }} × {{ image.height }} pixels</td>
                    </tr>
                    <tr>
                        <td><strong>Proporção:</strong></td>
                        <td>{{ image.aspect_ratio }}:1</td>
                    </tr>
                    <tr>
                        <td><strong>Megapixels:</strong></td>
                        <td>{{ image.megapixels }} MP</td>
                    </tr>
                    <tr>
                        <td><strong>Formato:</strong></td>
                        <td>{{ image.format }}</td>
                    </tr>
                    <tr>
                        <td><strong>Tamanho do Arquivo:</strong></td>
                        <td>{{ image.file_size|filesizeformat }}</td>
                    </tr>
                    <tr>
                        <td><strong>Bytes por Pixel:</strong></td>
                        <td>{{ image.bytes_per_pixel }}</td>
                    </tr>
                    <tr>
                        <td><strong>Tipo de Asset:</strong></td>
                        <td>
                            <span class="badge bg-secondary">
                                {{ image.get_asset_type_display }}
                            </span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Quality Analysis -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-star"></i> Análise de Qualidade
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center">
                            {% if image.quality_rating %}
                                <h3>
                                    <span class="badge quality-{{ image.quality_rating }} quality-badge" style="font-size: 1rem;">
                                        {{ image.get_quality_rating_display }}
                                    </span>
                                </h3>
                            {% else %}
                                <h3 class="text-muted">N/A</h3>
                            {% endif %}
                            <p class="text-muted">Classificação Geral</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            {% if image.quality_score %}
                                <h3 class="text-primary">{{ image.quality_score|floatformat:0 }}%</h3>
                            {% else %}
                                <h3 class="text-muted">N/A</h3>
                            {% endif %}
                            <p class="text-muted">Score Numérico</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Critérios de Usabilidade:</h6>
                        <ul class="list-unstyled">
                            <li>
                                {% if image.resolution_adequate %}
                                    <i class="bi bi-check-circle text-success"></i>
                                {% else %}
                                    <i class="bi bi-x-circle text-danger"></i>
                                {% endif %}
                                Resolução adequada (≥640×480)
                            </li>
                            <li>
                                {% if image.aspect_ratio_appropriate %}
                                    <i class="bi bi-check-circle text-success"></i>
                                {% else %}
                                    <i class="bi bi-x-circle text-danger"></i>
                                {% endif %}
                                Proporções adequadas para mobile
                            </li>
                            <li>
                                {% if image.file_size_optimized %}
                                    <i class="bi bi-check-circle text-success"></i>
                                {% else %}
                                    <i class="bi bi-x-circle text-danger"></i>
                                {% endif %}
                                Tamanho do arquivo otimizado
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recommendations -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-lightbulb"></i> Recomendações Específicas
                </h5>
            </div>
            <div class="card-body">
                {% if image.quality_rating == 'low' or not image.resolution_adequate or not image.aspect_ratio_appropriate or not image.file_size_optimized %}
                    <div class="alert alert-warning">
                        <h6><i class="bi bi-exclamation-triangle"></i> Problemas Detectados:</h6>
                        <ul class="mb-0">
                            {% if image.quality_rating == 'low' %}
                                <li>Qualidade geral baixa - considere usar uma imagem de melhor qualidade</li>
                            {% endif %}
                            {% if not image.resolution_adequate %}
                                <li>Resolução muito baixa ({{ image.width }}×{{ image.height }}) - recomendamos pelo menos 640×480 pixels</li>
                            {% endif %}
                            {% if not image.aspect_ratio_appropriate %}
                                <li>Proporção não ideal para dispositivos móveis - considere usar 16:9, 4:3, 1:1 ou similar</li>
                            {% endif %}
                            {% if not image.file_size_optimized %}
                                {% if image.file_size > 1048576 %}
                                    <li>Arquivo muito grande ({{ image.file_size|filesizeformat }}) - considere compressão para melhorar performance</li>
                                {% else %}
                                    <li>Arquivo pode estar excessivamente comprimido - verifique a qualidade visual</li>
                                {% endif %}
                            {% endif %}
                        </ul>
                    </div>
                {% else %}
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i>
                        <strong>Excelente!</strong> Esta imagem atende a todos os critérios de usabilidade recomendados.
                    </div>
                {% endif %}
                
                <!-- Specific recommendations based on asset type -->
                {% if image.asset_type == 'icon' %}
                    <div class="alert alert-info">
                        <h6><i class="bi bi-star"></i> Dicas para Ícones:</h6>
                        <ul class="mb-0">
                            <li>Ícones devem ser claros e reconhecíveis em tamanhos pequenos</li>
                            <li>Use formatos vetoriais quando possível (.svg)</li>
                            <li>Mantenha consistência visual entre todos os ícones</li>
                            <li>Tamanhos recomendados: 24×24, 32×32, 48×48, 64×64, 128×128 pixels</li>
                        </ul>
                    </div>
                {% elif image.asset_type == 'background' %}
                    <div class="alert alert-info">
                        <h6><i class="bi bi-image"></i> Dicas para Fundos:</h6>
                        <ul class="mb-0">
                            <li>Fundos devem ter boa resolução mas não ser excessivamente grandes</li>
                            <li>Considere usar gradientes ou cores sólidas para reduzir tamanho do arquivo</li>
                            <li>Certifique-se de que o contraste com o texto seja adequado</li>
                        </ul>
                    </div>
                {% elif image.asset_type == 'button' %}
                    <div class="alert alert-info">
                        <h6><i class="bi bi-square"></i> Dicas para Botões:</h6>
                        <ul class="mb-0">
                            <li>Botões devem ter tamanho adequado para toque (mínimo 44×44 pixels)</li>
                            <li>Use estados visuais claros (normal, pressionado, desabilitado)</li>
                            <li>Mantenha consistência visual entre todos os botões</li>
                        </ul>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Project Context -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h6><i class="bi bi-folder"></i> Contexto do Projeto</h6>
                <p class="text-muted mb-0">
                    <strong>Projeto:</strong> 
                    <a href="{% url 'file_detail' aia_file.pk %}">{{ aia_file.name }}</a> |
                    <strong>Extraída em:</strong> {{ image.created_at|date:"d/m/Y H:i" }}
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
