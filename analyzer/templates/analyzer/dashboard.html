{% extends 'analyzer/base.html' %}

{% block title %}Dashboard - Analisador de Apps .aia{% endblock %}

{% block content %}
<div style="margin-bottom: 32px;">
    <h1 class="md-headline-large">Dashboard</h1>
    <p class="md-body-large" style="color: var(--md-sys-color-on-surface-variant);">
        Visão geral dos seus projetos e análises
    </p>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-3" style="margin-bottom: 32px;">
    <div class="md-card md-card-elevated stat-card">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <div class="stat-number" style="color: var(--md-sys-color-primary);">{{ total_files }}</div>
                <div class="stat-label">Total de Arquivos</div>
            </div>
            <span class="material-icons" style="font-size: 48px; color: var(--md-sys-color-primary); opacity: 0.6;">
                folder
            </span>
        </div>
    </div>
    
    <div class="md-card md-card-elevated stat-card">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <div class="stat-number" style="color: var(--md-sys-color-success);">{{ analyzed_files }}</div>
                <div class="stat-label">Arquivos Analisados</div>
            </div>
            <span class="material-icons" style="font-size: 48px; color: var(--md-sys-color-success); opacity: 0.6;">
                check_circle
            </span>
        </div>
    </div>
    
    <div class="md-card md-card-elevated stat-card">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <div class="stat-number" style="color: var(--md-sys-color-warning);">{{ total_images }}</div>
                <div class="stat-label">Total de Imagens</div>
            </div>
            <span class="material-icons" style="font-size: 48px; color: var(--md-sys-color-warning); opacity: 0.6;">
                image
            </span>
        </div>
    </div>
</div>

<div class="grid grid-cols-2" style="gap: 24px;">
    <!-- Recent Files -->
    <div class="md-card">
        <div style="display: flex; align-items: center; margin-bottom: 16px;">
            <span class="material-icons" style="margin-right: 12px; color: var(--md-sys-color-primary);">
                history
            </span>
            <h2 class="md-title-large">Arquivos Recentes</h2>
        </div>
        
        {% if recent_files %}
            <div>
                {% for file in recent_files %}
                    <div style="padding: 16px; border: 1px solid var(--md-sys-color-surface-variant); border-radius: 12px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <h3 class="md-title-medium">
                                    <a href="{% url 'file_detail' file.pk %}" style="color: var(--md-sys-color-primary); text-decoration: none;">
                                        {{ file.name }}
                                    </a>
                                </h3>
                                <p class="md-body-medium" style="color: var(--md-sys-color-on-surface-variant); margin: 4px 0;">
                                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">
                                        schedule
                                    </span>
                                    {{ file.uploaded_at|date:"d/m/Y H:i" }}
                                    <span style="margin: 0 8px;">•</span>
                                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">
                                        storage
                                    </span>
                                    {{ file.file_size_mb }} MB
                                </p>
                            </div>
                            <div>
                                {% if file.is_analyzed %}
                                    <div class="md-chip quality-excellent">
                                        <span class="material-icons" style="font-size: 16px; margin-right: 4px;">check</span>
                                        Analisado
                                    </div>
                                {% else %}
                                    <div class="md-chip quality-medium">
                                        <span class="material-icons" style="font-size: 16px; margin-right: 4px;">hourglass_empty</span>
                                        Pendente
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px;">
                <span class="material-icons" style="font-size: 64px; color: var(--md-sys-color-on-surface-variant); opacity: 0.6;">
                    folder_open
                </span>
                <p class="md-body-large" style="color: var(--md-sys-color-on-surface-variant); margin: 16px 0;">
                    Nenhum arquivo enviado ainda
                </p>
                <a href="{% url 'upload_file' %}" class="md-button md-button-filled">
                    <span class="material-icons" style="margin-right: 8px;">cloud_upload</span>
                    Enviar Primeiro Arquivo
                </a>
            </div>
        {% endif %}
    </div>
    
    <!-- Recent Analyses -->
    <div class="md-card">
        <div style="display: flex; align-items: center; margin-bottom: 16px;">
            <span class="material-icons" style="margin-right: 12px; color: var(--md-sys-color-primary);">
                analytics
            </span>
            <h2 class="md-title-large">Análises Recentes</h2>
        </div>
        
        {% if recent_analyses %}
            <div>
                {% for analysis in recent_analyses %}
                    <div style="padding: 16px; border: 1px solid var(--md-sys-color-surface-variant); border-radius: 12px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <h3 class="md-title-medium">
                                    <a href="{% url 'analysis_results' analysis.aia_file.pk %}" style="color: var(--md-sys-color-primary); text-decoration: none;">
                                        {{ analysis.aia_file.name }}
                                    </a>
                                </h3>
                                <p class="md-body-medium" style="color: var(--md-sys-color-on-surface-variant); margin: 4px 0;">
                                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">
                                        schedule
                                    </span>
                                    {{ analysis.evaluated_at|date:"d/m/Y H:i" }}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div style="margin-bottom: 4px;">
                                    <span class="md-label-large" style="color: var(--md-sys-color-on-surface-variant);">
                                        Score Geral
                                    </span>
                                </div>
                                <div style="font-size: 24px; font-weight: 500; color: var(--md-sys-color-primary);">
                                    {{ analysis.overall_usability_score|floatformat:0 }}%
                                </div>
                                {% if analysis.total_issues > 0 %}
                                    <div class="md-chip quality-medium" style="margin-top: 4px;">
                                        {{ analysis.total_issues }} problema(s)
                                    </div>
                                {% else %}
                                    <div class="md-chip quality-excellent" style="margin-top: 4px;">
                                        <span class="material-icons" style="font-size: 16px;">check</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px;">
                <span class="material-icons" style="font-size: 64px; color: var(--md-sys-color-on-surface-variant); opacity: 0.6;">
                    analytics
                </span>
                <p class="md-body-large" style="color: var(--md-sys-color-on-surface-variant); margin: 16px 0;">
                    Nenhuma análise realizada ainda
                </p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="md-card" style="margin-top: 32px;">
    <div style="display: flex; align-items: center; margin-bottom: 16px;">
        <span class="material-icons" style="margin-right: 12px; color: var(--md-sys-color-primary);">
            bolt
        </span>
        <h2 class="md-title-large">Ações Rápidas</h2>
    </div>
    
    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
        <a href="{% url 'upload_file' %}" class="md-button md-button-filled">
            <span class="material-icons" style="margin-right: 8px;">cloud_upload</span>
            Enviar Novo Arquivo
        </a>
        <a href="{% url 'file_list' %}" class="md-button md-button-outlined">
            <span class="material-icons" style="margin-right: 8px;">folder</span>
            Ver Todos os Arquivos
        </a>
    </div>
</div>
{% endblock %}
